import React, { useState } from 'react'
import {
  Stage,
  Layer,
  Line,
  Text,
  Rect,
  Path,
  RegularPolygon,
  Shape,
} from 'react-konva'
import { makeStyles } from '@material-ui/core/styles'

import Swatch from './Swatch'
import Konva from 'konva'

const useStyles = makeStyles((theme) => ({
  activeCanvas: {
    display: 'flex',
  },
}))

const TestCanvas = () => {
  const classes = useStyles()
  const [lines, setLines] = useState([])
  const [drawing, setDrawing] = useState(false)
  const [stageRef, setStageRef] = useState()
  const [color, setColor] = useState('red')
  const randColor = ['red', 'blue', 'green', 'yellow']

  const handleMouseDown = () => {
    setDrawing(true)
    setLines([...lines, []])
  }
  const handleMouseUp = () => {
    setDrawing(false)
  }
  const handleMouseMove = (e) => {
    if (drawing === true) {
      const stage = stageRef.getStage()
      const point = stage.getPointerPosition()
      const tempLines = lines
      let lastLine = tempLines[tempLines.length - 1]
      lastLine = lastLine.concat([point.x, point.y])
      tempLines.splice(tempLines.length - 1, 1, lastLine)
      setLines(tempLines.concat())
    }
  }
  const setCurrentColor = (color) => {
    setColor(color)
  }

  return (
    <div>
      <div className={classes.activeCanvas}>
        <Stage
          width={window.innerWidth - 50}
          height={500}
          onContentMousedown={handleMouseDown}
          onContentMouseMove={handleMouseMove}
          onContentMouseup={handleMouseUp}
          ref={(node) => {
            setStageRef(node)
          }}
          style={{ backgroundColor: 'black' }}
        >
          <Layer
            onDblClick={(e) => {
              console.log(e)
            }}
          >
            {/* {lines &&
              lines.map((line, i) => (
                <Line
                  key={i}
                  points={line}
                  stroke={color}
                  tension={0.5}
                  bezier
                />
              ))}
            <Rect
              x={20}
              y={20}
              width={100}
              height={50}
              fill={color}
              draggable
            />
            <Line
              points={[23, 20, 23, 160, 70, 93, 150, 109, 290, 139, 270, 93]}
              lineJoin='bevel'
              // lineCap='round'
              stroke='white'
              strokeWidth={4}
              fill='red'
              // closed={true}
              // tension={0.5}
            />
            <Path
              fill='gold'
              draggable={true}
              data='M243.37,217.8c-8.02,4.74-13.52,9.67-11.38,20.77c2.44,12.67,16.39,22.38,27.36,24.78
				c8.97,1.96,22.07,0.27,29.39,2.72c1.81,0.61,3.63,1.84,5.36,2.44c1.17-1.27,1.62-2.3,3.37-3.9c2.67-2.43,5.14-3.16,8.34-8.03
				c2.06-3.14,0.11-1.72,3.75-3.04c-0.39-1.84-0.54-1.76,0.13-3.08c-8.99,2.17-14.19-3.38-17.38-2.93
				c-8.47,1.22-11.78,6.62-14.45,12.53c-0.34-2.67,1.25-7.31,2.86-9.65c2.24-3.27,6.87-4.79,10.12-4.57
				c-1.98-1.93-2.52-2.11-5.57-1.14c-7.56,2.4-9.73,8.64-10.8,14.93c-25.59,4.3-48.93-17.99-39.59-32.39
				c0.05,1.91-0.43,1.78-0.67,3.78c-1.16,9.64,10.11,16.25,19.48,17.21c4.53,0.46,10.62,0.35,15.65-0.34
				c2.82-0.39,5.6-1.16,8.43-2.38c3.82-1.66,5.12-1.98,8.65-3.02c-6.14-4.83-18.79-12.75-25.86-7.32c-2.9,2.23-3.49,5.37-2.91,8.66
				c-2.76-6.09,2.73-12.09,10.02-12.62c4.82-0.36,11.56,2.43,15.71,5.14c2.45,1.59,4.63,3.37,7.03,4.9
				c4.31,2.74,10.68,5.61,15.63,6.5c2.89,0.52,5.91-0.31,8.92-2.33c4.6,2.9,8.99,10.23,11.69,15.86c-0.1-0.06-0.27-0.28-0.26-0.23
				c0.01,0.06-0.19-0.17-0.25-0.23l-4.88-7.25c-2.08-2.95-3.7-3.81-5.76-6.08l-5.04,3.38c0.98,2.6,10.6,14.39,10.83,15.21
				c0.38,1.39-0.08,0.47-0.39,2.25c1.21,0.06,1.24,0.18,2.49,0.93c-1.55-0.05-4.05-0.84-5.63-1.1c-0.89-2.49,1.01,0.52-1.14-3.03
				c-2.88-4.76-1.06-7.47-4.79-10.92c-1.4,0.16-2.34,0.94-3.66,1.93c0.5,4.65-1.44,7.92,0.12,13.09c0.97-0.14,2.41-0.4,3.45-0.54
				c0.55-0.08,1.18-0.23,1.82-0.27l1.88,0.24c-1.66,0.67-3.8,1.33-2.81,3.02c0.4,0.68,2.84,2.38,3.52,2.67
				c2.74,1.18,5.21,1.25,8.12,1.99l-3.29,0.3c1.31,3.71,1.72-1.28,7.51,4.39c0.9,0.88,1.59,1.51,2.84,1.6l0.92-1.03
				c-0.53-3.37-2.14-0.61-0.09-5.84c1.12-2.87,0.91-1.92-1.28-5.95c1.86,1.44,3.78,3.31,3.93,5.88c-0.66,0.54-0.29,0.21-1.46-0.54
				c0.67,1.93,0.92,0.7,1.1,2.48l0.39,2.72c-1.7,1.92-1.53,3.08-3.84,4.14c-1.83,0.84-4.13,1.41-5.25-0.04
				c-1.69-2.2,0.83-2.61-2.66-4.85c-4.3-2.75-3.21,0.07-9.41-3.85c-6.6-4.17-6.27-2.33-9.32-4.04c-2.36-1.33-2.66-2.25-3.49-4.82
				c-1.18,0.85-3.09,1.25-0.99,5.47c1.08,2.17,2.97,3.95,2.93,6.57l-0.53-0.3c-0.77-0.52-0.1-0.02-0.74-0.54
				c-0.44-0.36-0.91-0.82-1.38-1.26c-1.91-1.75-6.78-5.21-8.74-6.03c-1.53-0.64-1.74-1.02-3.08-1.4c-14.11-4-19.72,1.54-37.25-4.83
				c-13.95-5.07-25.33-25.36-19.81-36.76C233.09,224.04,238.08,218.34,243.37,217.8L243.37,217.8z M267.84,251.58
				c-0.29,0.72-1.62,2.87-2.12,3.08c-2.9,1.24-15.05-2.6-19.03-4.65c-1.34-0.69-5.75-2.89-6.69-4.02
        c4.43,7.06,19.28,11.04,28.37,10.89c4.26-0.07,2.19-1.16,6.17-7.14l-12.75,1.46C264.59,251.95,265.62,251.34,267.84,251.58z,M284.62,175.44c47.68,0,86.34,38.66,86.34,86.34c0,47.69-38.66,86.34-86.34,86.34s-86.34-38.66-86.34-86.34
			C198.28,214.1,236.94,175.44,284.62,175.44L284.62,175.44z M284.62,177.91c-46.32,0-83.87,37.55-83.87,83.87
			c0,46.32,37.55,83.87,83.87,83.87c46.32,0,83.87-37.55,83.87-83.87C368.5,215.46,330.95,177.91,284.62,177.91z,M284.34,195.21c36.92,0,66.85,29.93,66.85,66.85c0,36.92-29.93,66.85-66.85,66.85s-66.85-29.93-66.85-66.85
			C217.49,225.14,247.42,195.21,284.34,195.21L284.34,195.21z M284.34,197.12c-35.87,0-64.94,29.08-64.94,64.94
			s29.08,64.94,64.94,64.94s64.94-29.08,64.94-64.94S320.21,197.12,284.34,197.12z,M324.16,309.95l0.5,1.11l-1.45-1.98c-8.53-10.12-14.84-14.05-24.27-18.15c-2.93-1.2-11.14-4.11-13.87-3.83
				c2.04,1.59,4.94,2.8,7.15,3.84c4.96,2.33,18.4,7.96,20.83,11.53c-1.46-2.01-15.93-7.53-19.14-8.22
				c-2.6-0.56-16.77-6.65-17.76-11.69c1.99-1.84,10.41-0.51,12.92,0.37l3.48,1.03c2.7,0.84,9.07,4.24,11.46,5.75
				C310.48,293.78,320.74,303.1,324.16,309.95z,M315.1,292.57c-3.35-1.52-14.41-11.78-27.97-14.34c-4.06-0.77-8.95-0.36-11.59-0.52
				c-9.26-0.56-14.85,0.77-24.99-4.67c-6.28-3.37-13.96-9.38-18.11-17.49c3.38,3.46,5.18,5.38,9.16,8.28
				c3.79,2.77,6.39,3.81,10.06,5.56c1.47,0.7,3.59,1.19,5.33,1.76c1.45,0.47,3.69,0.7,5.59,0.96c3.16,0.43,7.95,0.67,11.59,0.48
				c5.35-0.28,12.02,0.1,16.85,2.46c6.47,3.16,8.62,4.44,14.84,9.11C307.83,285.65,313.61,290.4,315.1,292.57z,M307.51,239.45c-0.51-3.1,0.56-5.31,4.06-6.96c0.01,1.16,0.02,0.22-0.1,1.1l-0.28,2.62
				c-0.02,1.3-0.16,2.63,0.03,3.77c0.56-1.42,0.75-1.59,1.01-3.15c0.2-1.27,0.18-2.06,0.84-3.38c1.29,2.48,1.34,8.28,0.68,10.32
				c-2.6,1.7-6.76,1.11-9.09,0.87c-5.45-0.56-11.32-4.76-15.67-7.31c-2.37-1.39-5.92-3.1-7.93-4.63c1.39,0.06,4.05,1.45,5.45,2.14
				c6.03,2.98,8.92,6.35,15.48,6.52c-1.72-1.05-3.16-1.63-4.97-3.44c-1.69-1.7-2.9-3.31-4.69-4.84c-2.7-2.3-8.44-5.91-10.56-5.83
				c1.23-0.03,2.01-0.07,3.14,0.33l3.45,1.15c1.91,0.81,4.24,2.01,6.32,3.35c4.65,3,4.38,3.94,10.84,6.8L307.51,239.45z,M320.38,254.11c-0.34,1.33-0.5,0.9-0.81,2.24c-0.09-0.04-0.25-0.23-0.24-0.17c0.08,0.54-0.55-1.48-2.73-0.46
				l3.42,4.96c-2.38-0.39-5.87-4.96-5.87-7.7C316.05,251.73,319.16,252.54,320.38,254.11z,M283.79,204.47c32.12,0,58.16,26.04,58.16,58.16c0,16.46-6.84,31.33-17.84,41.91
			c-0.32-0.38-0.69-0.72-1.13-1.01l-0.13-0.09c10.74-10.28,17.43-24.77,17.43-40.81c0-31.2-25.29-56.49-56.49-56.49
			c-13.87,0-26.57,5.01-36.4,13.31c-0.56,0.06-1.1,0.21-1.59,0.44c-0.36,0.08-0.71,0.2-1.05,0.35l-0.03,0.01l-0.02,0l0,0l-0.01,0
			l-0.02,0l-0.07,0.02l-0.02,0l-0.01,0l0,0l-0.12,0.03l0,0l-0.06,0.02l-0.02,0.01l-0.02,0.01l-0.02,0l-0.01,0l-0.01,0l-0.02,0.01
			l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l0,0l-0.01,0l-0.02,0.01l-0.06,0.02l-0.02,0.01l-0.01,0
			l-0.01,0l-0.02,0.01l-0.05,0.02l-0.02,0.01l-0.02,0.01l-0.02,0.01l0,0l-0.01,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01
			l-0.02,0.01l-0.02,0.01l-0.01,0l-0.01,0l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l-0.02,0.01l0,0
			l-0.01,0.01h0l-0.1,0.02C254.05,210.61,268.2,204.47,283.79,204.47L283.79,204.47z M229.13,248.29v-5.57
			c-2.26,6.21-3.5,12.91-3.5,19.9c0,32.12,26.04,58.16,58.15,58.16c11.77,0,22.72-3.5,31.88-9.51c-0.44-0.37-0.82-0.79-1.11-1.26
			c-8.85,5.76-19.42,9.11-30.77,9.11c-31.2,0-56.49-25.29-56.49-56.49C227.29,257.67,227.93,252.87,229.13,248.29z,M239.03,319.93l4.19-1.59l11.46,7.35l-3.61,0.8l-7.52-4.82l-1.23,0.37l0.14,1.35l7.53,4.83l0.3,4.32l-4.2,1.6
			l-11.46-7.35l3.63-0.79l7.51,4.81l1.26-0.38l-0.15-1.36l-7.54-4.84L239.03,319.93L239.03,319.93z M224.88,304.56l-0.91,4.21
			l5.87,6.77l-0.24,1.34l-1.32,0.01l-5.84-6.74l-3.71-0.27l8.92,10.29l4.48-0.35l0.93-4.23l-5.86-6.76l0.25-1.33l1.28,0l5.85,6.75
			l3.69,0.25l-8.92-10.29L224.88,304.56L224.88,304.56z M215.44,285.79l4.38,0.95l5.61,12.41l-3.47-1.29l-3.68-8.14l-1.23-0.36
			l-0.62,1.21l3.69,8.15l-2.1,3.79l-4.39-0.94l-5.61-12.41l3.48,1.31l3.67,8.13l1.27,0.37l0.62-1.22l-3.69-8.16L215.44,285.79
			L215.44,285.79z M211.76,265.09l3.91,2.19l1.72,13.51l-2.94-2.26l-1.13-8.86l-1.07-0.71l-0.94,0.97l1.13,8.88l-3.12,3l-3.92-2.19
			l-1.72-13.51l2.94,2.28l1.12,8.85l1.11,0.72l0.95-0.98l-1.13-8.89L211.76,265.09L211.76,265.09z M213.61,244.44l3.24,3.1
			l-1.72,13.51l-2.28-2.92l1.13-8.86l-0.86-0.95l-1.16,0.71l-1.13,8.88l-3.77,2.13l-3.25-3.1l1.72-13.51l2.28,2.94l-1.12,8.85
			l0.89,0.98l1.16-0.71l1.13-8.89L213.61,244.44L213.61,244.44z M221.88,225.19l2.18,3.92l-5.61,12.41l-1.32-3.46l3.68-8.14
			l-0.54-1.16l-1.31,0.33l-3.69,8.15l-4.23,0.92l-2.19-3.92l5.61-12.41l1.31,3.48l-3.67,8.13l0.56,1.19l1.32-0.34l3.69-8.16
			L221.88,225.19L221.88,225.19z M234.9,208.9l-4.3-0.3l-5.87,6.77l-1.37-0.05l-0.2-1.31l5.84-6.74l-0.27-3.71l-8.92,10.29
			l0.98,4.38l4.32,0.32l5.86-6.76l1.35,0.05l0.19,1.27l-5.85,6.75l0.28,3.69l8.92-10.29L234.9,208.9L234.9,208.9z M252.22,196.8
			l-0.3,4.47l-11.46,7.35l0.78-3.62l7.52-4.82l0.18-1.27l-1.28-0.43l-7.53,4.83l-4.05-1.53l0.3-4.48l11.46-7.35l-0.79,3.63
			l-7.51,4.81l-0.18,1.31l1.3,0.43l7.54-4.84L252.22,196.8L252.22,196.8z M272.21,190.34l-1.58,4.2l-13.1,3.72l1.79-3.24l8.6-2.44
			l0.54-1.16l-1.1-0.79l-8.61,2.44l-3.44-2.64l1.58-4.2l13.1-3.72l-1.81,3.25l-8.58,2.44l-0.55,1.2l1.11,0.79l8.62-2.45
			L272.21,190.34L272.21,190.34z M293.18,189.89l-2.76,3.53l-13.61-0.34l2.67-2.56l8.93,0.23l0.86-0.95l-0.82-1.08l-8.95-0.23
			l-2.5-3.54l2.76-3.54l13.61,0.34l-2.69,2.56l-8.92-0.23l-0.88,0.98l0.83,1.09l8.96,0.23L293.18,189.89L293.18,189.89z
			 M313.32,194.87l-3.55,2.74l-13.1-3.72l3.23-1.82l8.6,2.44l1.07-0.71l-0.52-1.25l-8.61-2.44l-1.54-4.05l3.55-2.75l13.1,3.72
			l-3.25,1.81l-8.58-2.44l-1.1,0.73l0.53,1.26l8.62,2.45L313.32,194.87L313.32,194.87z M331.19,205.63l-0.32-4.3l-7.54-4.83
			l-0.15-1.36l1.26-0.38l7.51,4.81l3.63-0.79l-11.46-7.35l-4.2,1.6l0.3,4.32l7.53,4.83l0.14,1.35l-1.23,0.37l-7.52-4.82l-3.61,0.81
			l11.46,7.35L331.19,205.63L331.19,205.63z M345.39,221.2l-4.47,0.34L332,211.25l3.69,0.25l5.85,6.75l1.28,0l0.25-1.33l-5.86-6.76
			l0.93-4.23l4.48-0.35l8.92,10.29l-3.71-0.27l-5.84-6.74l-1.32,0.01l-0.24,1.34l5.87,6.77L345.39,221.2L345.39,221.2z
			 M354.68,239.97l-4.38-0.95l-5.61-12.41l3.47,1.29l3.68,8.14l1.23,0.36l0.62-1.21l-3.69-8.15l2.1-3.79l4.39,0.94l5.61,12.41
			l-3.48-1.31l-3.67-8.13l-1.27-0.37l-0.62,1.22l3.69,8.16L354.68,239.97L354.68,239.97z M358.2,260.67l-3.91-2.19l-1.72-13.51
			l2.94,2.26l1.13,8.86l1.07,0.71l0.94-0.97l-1.13-8.88l3.12-3l3.92,2.19l1.72,13.51l-2.94-2.28l-1.12-8.85l-1.11-0.72l-0.95,0.98
			l1.13,8.89L358.2,260.67L358.2,260.67z M355.57,281.38l-3.08-3.26l2.39-13.41l2.13,3.03l-1.57,8.8l0.81,0.99l1.19-0.65l1.57-8.81
			l3.87-1.93l3.09,3.26l-2.39,13.41l-2.12-3.05l1.57-8.78l-0.84-1.02l-1.2,0.66l-1.57,8.82L355.57,281.38L355.57,281.38z
			 M347.78,300.77l-2.18-3.92l5.61-12.41l1.32,3.46l-3.68,8.14l0.54,1.16l1.31-0.33l3.69-8.15l4.23-0.92l2.19,3.92l-5.61,12.41
			l-1.31-3.48l3.67-8.13l-0.56-1.19l-1.32,0.34l-3.69,8.16L347.78,300.77L347.78,300.77z M334.41,316.86l4.3,0.3l5.87-6.77
			l1.37,0.05l0.2,1.31l-5.84,6.74l0.27,3.71l8.92-10.29l-0.98-4.38l-4.32-0.32l-5.86,6.76l-1.35-0.05l-0.19-1.27l5.85-6.75
			l-0.28-3.69l-8.92,10.29L334.41,316.86L334.41,316.86z M316.94,328.57l0.3-4.47l11.46-7.35l-0.78,3.62l-7.52,4.82l-0.18,1.27
			l1.28,0.43l7.53-4.83l4.05,1.53l-0.3,4.48l-11.46,7.35l0.79-3.63l7.51-4.81l0.18-1.31l-1.3-0.43l-7.54,4.83L316.94,328.57
			L316.94,328.57z M297,335.02l1.58-4.2l13.1-3.72l-1.79,3.24l-8.6,2.44l-0.54,1.16l1.1,0.79l8.61-2.44l3.44,2.64l-1.58,4.2
			l-13.1,3.72l1.81-3.25l8.58-2.44l0.55-1.2l-1.11-0.79l-8.62,2.45L297,335.02L297,335.02z M275.88,335.27l2.76-3.53l13.61,0.34
			l-2.67,2.56l-8.93-0.23l-0.86,0.95l0.82,1.08l8.95,0.23l2.5,3.54l-2.76,3.54l-13.61-0.34l2.69-2.56l8.92,0.23l0.88-0.98
			l-0.83-1.09l-8.96-0.23L275.88,335.27L275.88,335.27z M255.85,329.67l1.35,4.09l8.49,2.87l0.47,1.28l-1.13,0.68l-8.45-2.86
			l-3.33,1.65l12.9,4.36l3.68-2.57l-1.34-4.12l-8.48-2.87l-0.46-1.27l1.1-0.65l8.46,2.86l3.31-1.65l-12.9-4.36L255.85,329.67z'
            />
            <RegularPolygon
              x={100}
              y={100}
              sides={20}
              radius={100}
              fill='green'
            /> */}
            <Shape
              sceneFunc={(context, shape) => {
                context.beginPath()
                context.moveTo(10, 50)
                context.lineTo(220, 80)
                context.quadraticCurveTo(150, 100, 260, 170)
                context.quadraticCurveTo(440, 100, 200, 80)
                context.closePath()
                // (!) Konva specific method, it is very important
                context.fillStrokeShape(shape)
              }}
              fill='#00D2FF'
              stroke='white'
              strokeWidth={4}
              draggable
            />
          </Layer>
        </Stage>
        <Swatch setCurrentColor={setCurrentColor} />
      </div>{' '}
      <Stage
        width={window.innerWidth}
        height={500}
        style={{ border: '5px solid white', backgroundColor: 'black' }}
      >
        <Layer>
          {lines &&
            lines.map((line, i) => (
              <Line key={i} points={line} stroke='white' />
            ))}
        </Layer>
      </Stage>
    </div>
  )
}

export default TestCanvas
